<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">

<f:view id="viewAdmin" contentType="text/html">

	<h:head>
		<f:facet name="first">
			<meta content='text/html; charset=UTF-8' http-equiv="Content-Type" />
			<title>Bievenido a LookDoocs</title>
		</f:facet>
	</h:head>

	<f:metadata>
		<f:viewAction id="metadata"
			action="#{categoriasView.consultarArbol()}" />
	</f:metadata>

	<h:body>
		<ui:composition template="/FeedPrincipalAdministrador.xhtml">
			<ui:define name="body">

				<p:growl id="msgs" showDetail="true" autoUpdate="true" />
				<h:form id="formId" enctype="multipart/form-data">

					<p:panel id="prueba">
						<f:metadata>
							<f:viewAction id="metadata"
								action="#{categoriasView.consultarArbol()}" />
						</f:metadata>
						<p:tabView id="tab">
							<p:tab title="Subir Documentos">
								<h:panelGrid columns="2" cellpadding="10">
									<p:fileUpload value="#{articulosView.file}" mode="simple" />
									<br />
									<p:outputLabel value="Nombre" />
									<p:inputText id="txtnombre"
										binding="#{articulosView.txtNombre}" />
									<p:outputLabel value="Descripcion" />
									<p:inputTextarea rows="10" cols="50"
										binding="#{articulosView.txtAreaDes}" queryDelay="750"
										minQueryLength="4" />
									<p:outputLabel value="Estado: " />
									<h:selectOneMenu id="estadoCate" label="Text 3"
										value="#{articulosView.estadoRegArticulo}">
										<f:selectItem itemLabel="Tipo" noSelectionOption="true" />
										<f:selectItem itemLabel="Activa" itemValue="1" />
										<f:selectItem itemLabel="Inactiva" itemValue="2" />
									</h:selectOneMenu>
									<p:commandButton id="btnSubir" value="Subir Documento"
										action="#{articulosView.action_create()}" ajax="false" />
									<p:commandButton id="btnPublicar" value="Publicar Documento"
										onclick="PF('ht').show();" />
								</h:panelGrid>
							</p:tab>
							<p:tab title="Feed de Articulos">
								<h:form id="form">


									<p:panel id="panelDataArticulos" header="Articulos">
										<p:messages id="msg" closable="true" autoUpdate="true" />
										<p:dataTable id="tabla" value="#{articulosView.data}"
											var="articulos" paginator="true" rows="5" editable="true">

											<p:ajax event="rowEdit" update="tabla"
												listener="#{articulosView.rowEventListener}" />
											<p:column filterBy="#{articulos.nombre}"
												sortBy="#{articulos.nombre}" headerText="Nombre">

												<p:cellEditor>

													<f:facet name="output">
														<h:outputText value="#{articulos.nombre}" />
													</f:facet>

													<f:facet name="input">
														<p:inputText value="#{articulos.nombre}" />
													</f:facet>
												</p:cellEditor>
											</p:column>

											<p:column filterBy="#{articulos.descripcion}"
												sortBy="#{articulos.descripcion}" headerText="Descripcion">

												<p:cellEditor>

													<f:facet name="output">
														<h:outputText value="#{articulos.descripcion}" />
													</f:facet>

													<f:facet name="input">
														<p:inputTextarea value="#{articulos.descripcion}" />
													</f:facet>
												</p:cellEditor>
											</p:column>

											<p:column filterBy="#{articulos.autor}"
												sortBy="#{articulos.autor}" headerText="Autor">

												<p:cellEditor>

													<f:facet name="output">
														<h:outputText value="#{articulos.autor}" />
													</f:facet>

													<f:facet name="input">
														<h:outputText value="#{articulos.autor}" />
													</f:facet>
												</p:cellEditor>
											</p:column>





											<p:column filterBy="#{articulos.estadoRegistro}"
												sortBy="#{articulos.estadoRegistro}" headerText="Estado">

												<p:cellEditor>

													<f:facet name="output">
														<h:outputText value="#{articulos.estadoRegistro}" />
													</f:facet>

													<f:facet name="input">
														<h:outputText value="#{articulos.estadoRegistro}" />
													</f:facet>
												</p:cellEditor>
											</p:column>
											<p:column filterBy="#{articulos.fechaCreacion}"
												sortBy="#{articulos.fechaCreacion}"
												headerText="Fecha de Creacion">

												<p:cellEditor>

													<f:facet name="output">
														<h:outputText value="#{articulos.fechaCreacion}">
															<f:convertDateTime pattern="dd/MM/yyyy" />
														</h:outputText>
													</f:facet>

													<f:facet name="input">
														<h:outputText value="#{articulos.fechaCreacion}">
															<f:convertDateTime pattern="dd/MM/yyyy" />
														</h:outputText>
													</f:facet>
												</p:cellEditor>
											</p:column>

											<p:column headerText="Options">
												<p:rowEditor id="row" />
												<p:tooltip for="row" value="Editar" showEffect="fade"
													hideEffect="fade" />
												<p:tooltip for="btnDeleteTabla" value="Borrar"
													showEffect="fade" hideEffect="fade" />
												<p:commandButton id="btnDeleteTabla"
													actionListener="#{articulosView.actionDeleteDataTableEditable}"
													title="Delete"
													onclick="if(!confirm('Esta seguro que desea borrar este articulo?. Los datos relacionados tambien se borraran.')){return false;}"
													icon="ui-icon-trash" update="tabla"
													style="width: 1.5em;height: 1.5em;">
													<f:attribute name="selectedArticulos" value="#{articulos}" />
												</p:commandButton>

											</p:column>

										</p:dataTable>


									</p:panel>

								</h:form>

							</p:tab>

						</p:tabView>
					</p:panel>



					<p:dialog header="Seleccionar categoria" widgetVar="ht"
						minHeight="40">
						<h:outputText value="Seleccione la Categoria: " />
						<br />
						<h:selectOneMenu id="txt30" label="Categorias"
							value="#{articulosView.categoriaSelected}">
							<f:selectItem itemLabel="Seleccione la categoría"
								noSelectionOption="true" />
							<f:selectItems value="#{articulosView.lasCategoriasItems}" />>
						</h:selectOneMenu>
						<p:separator />
						<p:commandButton value="Publicar"
							action="#{articulosView.action_create()}"
							onclick="if(!confirm('Realmente desea publicar este articulo?')){return false;}"
							ajax="false" />
					</p:dialog>


					<!-- BARRA DE CARGA DE DESCARGA : PARA QUE FUNCIONE el growl debe ir afuera del form -->
					<!--						      con el atributo => autoUpdate="true"      Y AL BOTON AGREGARLE LO SIGUIENTE: -->
					<!-- 							  onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()"-->
					<p:dialog widgetVar="statusDescarga" header="Descargando"
						draggable="false" closable="false" resizable="false">
						<p:graphicImage
							url="#{facesContext.externalContext.request.scheme}://#{facesContext.externalContext.request.serverName}:#{facesContext.externalContext.request.serverPort}#{facesContext.externalContext.request.contextPath}/images/ajaxloadingbar.gif" />
					</p:dialog>
					<!-- BARRA DE CARGA DE DESCARGA -->

					<p:dialog header="Cambiar categoría" widgetVar="dlg1"
						minHeight="40">
						<h:outputText value="Seleccione la Categoria: " />
						<br />
						<h:selectOneMenu id="txt3" label="Categorias"
							value="#{articulosView.categoriaSelected}">
							<f:selectItem itemLabel="Seleccione la categoría"
								noSelectionOption="true" />
							<f:selectItems value="#{articulosView.lasCategoriasItems}" />>
													</h:selectOneMenu>
						<p:separator />
						<p:commandButton id="btnCambiar" value="Cambiar"
							action="#{articulosView.action_modifyCategoria()}">
							<f:attribute name="selectedArticulos" value="#{articulos}" />
						</p:commandButton>

					</p:dialog>
				</h:form>
				<p:ajaxStatus onstart="PF('statusDialog').show()"
					onsuccess="PF('statusDialog').hide()" />
				<p:dialog widgetVar="statusDialog" header="Loading"
					draggable="false" closable="false">
					<p:graphicImage
						value="#{facesContext.externalContext.request.scheme}://#{facesContext.externalContext.request.serverName}:#{facesContext.externalContext.request.serverPort}#{facesContext.externalContext.request.contextPath}/images/ajaxloadingbar.gif" />
				</p:dialog>






			</ui:define>
		</ui:composition>
	</h:body>
</f:view>
</html>