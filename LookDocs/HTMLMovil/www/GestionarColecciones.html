<!DOCTYPE html> 
<html>
<head>
<meta charset="utf-8">
<title>Colecciones</title>
<link rel="stylesheet" href="jquery-mobile/jquery.mobile-1.4.5.min.css">
	<script src="jquery-mobile/jquery.js"></script>
	<script src="jquery-mobile/jquery.mobile-1.4.5.min.js"></script>
	<script type="text/javascript" charset="utf-8">
		var usuario = window.localStorage.getItem("nombreUsuario");
		//traerColecciones();
		
		function toFeedPrincipal(){
			window.location="FeedPrincipalLector.html";
		}
		
		function guardarColeccion(){
			var coleccionName = $('#nombreColeccion').val();
			
			$.post('http://127.0.0.1:8080/LookDocs/controller/lookDocs/crearColeccion',{correo:usuario,nombreColeccion:coleccionName},function(retorno){
			if (retorno=="exito") {
				alert("Se ha guardado la colección " +coleccionName);
				$('#nombreColeccion').val("");
			}else{
				alert(retorno);
			};
			});
		}
		
		function traerColeccionesModificar(){
			$.get('http://127.0.0.1:8080/LookDocs/controller/lookDocs/obtenercolecciones',{mail:usuario},function(data){
			if (data==null) {
				alert("El usuario no tiene colecciones");
			}else{
				$('#listaColeccionesModificar').empty().append('<option onclick="modificarColeccion()" value="0">Seleccione una Colección</option>').find('option:first').attr("selected","selected");
				if(data!=null){
				//Inserta los valores recuperados en la lista desplegable
				$.each(data, function(i, value) {
				$('#listaColeccionesModificar').append('<option value='+value.codigoCole+'>'+value.nombre+'</option>');
				});}
				//Actualiza la lista desplegable
				$('#listaColeccionesModificar').selectmenu("refresh", true);
			};
			});
		}
		
		function traerColeccionesEliminar(){
			$.get('http://127.0.0.1:8080/LookDocs/controller/lookDocs/obtenercolecciones',{mail:usuario},function(data){
			if (data==null) {
				alert("El usuario no tiene colecciones");
			}else{
				$('#listaColeccionesEliminar').empty().append('<option value="0">Seleccione una Colección</option>').find('option:first').attr("selected","selected");
				if(data!=null){
				//Inserta los valores recuperados en la lista desplegable
				$.each(data, function(i, value) {
				$('#listaColeccionesEliminar').append('<option value='+value.codigoCole+'>'+value.nombre+'</option>');
				});}
				//Actualiza la lista desplegable
				$('#listaColeccionesEliminar').selectmenu("refresh", true);
			};
			});
		}
		
		function traerColeccionDadoId(){
			var idCol = document.getElementById("listaColeccionesModificar").value;
			if(idCol ==0){
				alert("Debe seleccionar una colección");
			}else{
				$.get('http://127.0.0.1:8080/LookDocs/controller/lookDocs/obtenerColeccionDadoId',{idColeccion:idCol},function(data){
				$('#nuevoNombreColeccion').val(""+data);
				});
		
			}

		}
		
		function modificarColeccion(){
			var idCole = document.getElementById("listaColeccionesModificar").value;
			var nuevoNombreColeccion = $('#nuevoNombreColeccion').val();
			if(idCole ==0){
				alert("Debe seleccionar una colección");
			}else{
				$.post('http://127.0.0.1:8080/LookDocs/controller/lookDocs/modificarColeccion',{nuevoNombreCole:nuevoNombreColeccion,idColeccion:idCole,correo:usuario},function(retorno){
				if (retorno=="coleccionModificada") {
					alert("Se ha modificado la colección a "+nuevoNombreColeccion);
					$('#nuevoNombreColeccion').val("");
					traerColeccionesModificar();
					traerColeccionesEliminar();
				}else{
					alert(retorno);
				};
			});
			}	
		}
		
		function eliminarColeccion(){
			var idCole = document.getElementById("listaColeccionesEliminar").value;
			if(idCole ==0){
				alert("Debe seleccionar una colección");
			}else{
				$.post('http://127.0.0.1:8080/LookDocs/controller/lookDocs/eliminarColeccion',{idColeccion:idCole,correo:usuario},function(retorno){
				if (retorno=="coleccionEliminada") {
					alert("Se ha eliminado la colección");
					traerColeccionesModificar();
					traerColeccionesEliminar();
				}else{
					alert(retorno);
				};
			});
			}	
		}
	</script>
</head> 
<body>
<div data-role="page" id="page">
  <div data-role="header" data-theme="b">
    <h1>Colecciones</h1>
     <a onclick="toFeedPrincipal()" data-icon="arrow-l"  data-rel="close" data-iconpos="notext">Regresar</a>
  </div>
	<div data-role="collapsible" data-theme="b">
		<h4>Crear Colección</h4>
			<label for="nombreColeccion">Ingresa un nombre para la nueva colección: *</label>
			<input  id="nombreColeccion" type="text" name="nombreColeccion" value=""  />
			<a onclick="guardarColeccion()"  data-role="button">Guardar Colección</a>
	</div>
	<div data-role="collapsible" data-theme="b">
		<h4 onclick="traerColeccionesModificar()">Modificar Colección</h4>
			<select onchange="traerColeccionDadoId()" name="listaColeccionesModificar" id="listaColeccionesModificar">
			</select>
			<label for="nombreColeccion">Ingresa un nuevo nombre para la colección: *</label>
			<input  id="nuevoNombreColeccion" type="text" name="nuevoNombreColeccion" value=""  />
			<a onclick="modificarColeccion()"  data-role="button">Modificar Colección</a>
	</div>
	<div data-role="collapsible" data-theme="b">
		<h4 onclick="traerColeccionesEliminar()">Eliminar Colección</h4>
			<select name="listaColeccionesEliminar" id="listaColeccionesEliminar">
			</select>
			<a onclick="eliminarColeccion()"  data-role="button">Eliminar Colección</a>
	</div>
	  
	  
    
  	
    


  
</div>

</body>
</html>
